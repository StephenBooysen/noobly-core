"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.highlight = void 0;
var escapeRegexString_1 = require("./escapeRegexString");
var internalFilter_1 = require("./internalFilter");
var highlight = function (ast, data) {
    var highlights = [];
    (0, internalFilter_1.internalFilter)(ast, [data], false, [], highlights);
    var aggregatedHighlights = [];
    var _loop_1 = function (highlightNode) {
        var aggregatedHighlight = aggregatedHighlights.find(function (maybeTarget) {
            return maybeTarget.path === highlightNode.path;
        });
        if (!aggregatedHighlight) {
            aggregatedHighlight = {
                keywords: [],
                path: highlightNode.path,
            };
            aggregatedHighlights.push(aggregatedHighlight);
        }
        if (highlightNode.keyword) {
            aggregatedHighlight.keywords.push(highlightNode.keyword);
        }
    };
    for (var _i = 0, highlights_1 = highlights; _i < highlights_1.length; _i++) {
        var highlightNode = highlights_1[_i];
        _loop_1(highlightNode);
    }
    return aggregatedHighlights.map(function (aggregatedHighlight) {
        if (aggregatedHighlight.keywords.length > 0) {
            return {
                path: aggregatedHighlight.path,
                query: new RegExp('(' + aggregatedHighlight.keywords.map(function (keyword) {
                    return (0, escapeRegexString_1.escapeRegexString)(keyword.trim());
                }).join('|') + ')'),
            };
        }
        return {
            path: aggregatedHighlight.path,
        };
    });
};
exports.highlight = highlight;
